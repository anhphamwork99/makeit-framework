#!/bin/sh

# ============================================================
# ğŸ›¡ï¸ Pre-commit Guard: Block workspace-only files
# NgÄƒn commit files thuá»™c .agent/, .planning/, .makeit/
# ÄÃ¢y lÃ  development artifacts, khÃ´ng pháº£i deliverables
# ============================================================

# Láº¥y danh sÃ¡ch files Ä‘ang staged (sáº½ Ä‘Æ°á»£c commit)
# Note: "|| true" prevents grep exit code 1 (no match) from
# triggering sh -e (Husky runs hooks with set -e)
BLOCKED_FILES=$(git diff --cached --name-only | grep -E '^\.(agent|planning|makeit)/' || true)

if [ -n "$BLOCKED_FILES" ]; then
  echo ""
  echo "ğŸ›‘ BLOCKED: Workspace-only files detected in commit!"
  echo ""
  echo "CÃ¡c files sau thuá»™c .gitignore vÃ  khÃ´ng nÃªn commit:"
  echo "$BLOCKED_FILES" | sed 's/^/  âŒ /'
  echo ""
  echo "ğŸ’¡ Fix:"
  echo "  git reset HEAD <file>        â€” unstage file"
  echo "  git rm --cached <file>       â€” untrack file khá»i git"
  echo ""
  echo "âš ï¸  Náº¿u THá»°C Sá»° cáº§n commit (ráº¥t hiáº¿m):"
  echo "  git commit --no-verify       â€” bypass hook"
  echo ""
  exit 1
fi
